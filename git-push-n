#!/usr/local/bin/bash

if [ $# -ne 2 ]; then
    echo "usage: git push-n <remote> <ref>" >&2
    exit 1
fi

output=$(git push -n "$@" 2>&1)
git_rc=$?

echo "$output" >&2

range=$(
echo $output |
sed -n -r -e 's,^.* ([0-9a-f]+\.\.[0-9a-f]+).*,\1,p'
)

if [ -n "$range" ]; then
    exec git log $range
fi

exit $git_rc
